<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Registro de Pesos Profesional</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  html,body {margin:0;padding:0;height:100%; background:#2d3144; color:#e0e0e0; font-family:sans-serif;}
  #app {max-width:450px; margin:0 auto; padding:1rem;}
  .card {background:#3a3f5c; padding:1rem; border-radius:1rem; margin-bottom:1rem; box-shadow:0 4px 12px rgba(0,0,0,0.5);}
  input,button,select {background:#2d3144; color:#e0e0e0; border:1px solid #555; border-radius:0.375rem; padding:0.5rem;}
  input:focus {outline:none; border-color:#ff6f61;}
  button:hover {opacity:0.9; cursor:pointer;}
  h1,h2 {text-align:center;}
  .muscle-section h2 {margin-bottom:0.5rem; font-size:1.2rem;}
  .entry-row {display:flex; justify-content:space-between; align-items:center; padding:0.5rem; border-radius:0.5rem; background:#2d3144; margin-bottom:0.5rem;}
  .entry-row div {flex:1; text-align:center;}
  .entry-row button {flex:0 0 auto;}
  @media (max-width: 480px) {
    .entry-row {flex-direction:column; gap:0.25rem; text-align:center;}
    .entry-row div {width:100%;}
  }
</style>
</head>
<body>
<div id="app">
<h1 class="text-2xl font-bold mb-4">Registro de Pesos</h1>

<div class="card">
  <form id="entryForm" class="grid grid-cols-1 gap-3 mb-4">
    <input type="text" name="exercise" placeholder="Ejercicio" required>
    <input type="number" name="weight" step="0.5" placeholder="Peso (kg)" required>
    <input type="number" name="reps" value="5" placeholder="Reps" required>
    <input type="date" name="date" placeholder="Fecha">
    <div class="text-center mt-2">
      <button type="submit" class="px-4 py-2 bg-red-600 rounded-md mr-2">Añadir</button>
      <button type="button" id="exportBtn" class="px-4 py-2 bg-green-600 rounded-md">Exportar CSV</button>
    </div>
  </form>
</div>

<div id="entriesArea"></div>
</div>

<script>
const STORAGE_KEY='gym_entries_min';
let entries=JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]');

const MUSCLE_MAP={
  'Pecho':['Press banca','Aperturas','Fondos'],
  'Espalda':['Dominadas','Remo','Peso muerto'],
  'Piernas':['Sentadilla','Prensa','Zancadas','Curl femoral'],
  'Hombros':['Press militar','Elevaciones laterales','Face pull'],
  'Brazos':['Curl bíceps','Extensión tríceps','Fondos de brazos'],
  'Core':['Plancha','Crunch','Elevación piernas'],
};

function getMuscleGroup(exercise){
  for(const [zone,exs] of Object.entries(MUSCLE_MAP)){
    if(exs.some(e=>e.toLowerCase()===exercise.toLowerCase())) return zone;
  }
  return 'Otros';
}

function formatDate(d){ return new Date(d).toISOString().slice(0,10); }

function recommendNext(weight,reps){
  if(!weight) return '';
  let increment;
  if(weight<20) increment=1;
  else if(weight<50) increment=2.5;
  else if(weight<100) increment=5;
  else increment=Math.round(weight*0.03*10)/10;
  const nextWeight=Math.round((weight+increment)*10)/10;
  return `Si completas las ${reps} reps, sube ${increment} kg la próxima sesión (${weight} → ${nextWeight} kg)`;
}

function saveEntries(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(entries)); }

function renderEntries(){
  const area=document.getElementById('entriesArea');
  area.innerHTML='';
  if(!entries.length){ area.innerHTML='<p class="text-gray-400 text-center">No hay entradas aún.</p>'; return; }

  const grouped={};
  entries.forEach(e=>{
    const zone=getMuscleGroup(e.exercise);
    if(!grouped[zone]) grouped[zone]=[];
    grouped[zone].push(e);
  });

  for(const [zone,exs] of Object.entries(grouped)){
    const section=document.createElement('div');
    section.className='muscle-section';
    const h2=document.createElement('h2'); h2.textContent=zone; section.appendChild(h2);

    exs.slice().reverse().forEach((e,i)=>{
      const row=document.createElement('div');
      row.className='entry-row';
      row.innerHTML=`<div>${formatDate(e.date)}</div>
                     <div>${e.exercise}</div>
                     <div>${e.weight} kg</div>
                     <div>${e.reps} reps</div>
                     <div>${recommendNext(e.weight,e.reps)}</div>
                     <button data-index="${i}" data-zone="${zone}" class="text-red-500">Borrar</button>`;
      section.appendChild(row);
    });
    area.appendChild(section);
  }

  document.querySelectorAll('.entry-row button').forEach(btn=>{
    btn.addEventListener('click', e=>{
      const idx=parseInt(e.target.dataset.index);
      const zone=e.target.dataset.zone;
      const zoneEntries=entries.filter(x=>getMuscleGroup(x.exercise)===zone);
      const toDelete=zoneEntries[zoneEntries.length-1-idx];
      if(confirm('¿Borrar esta entrada?')){
        entries=entries.filter(x=>x!==toDelete);
        saveEntries();
        renderEntries();
      }
    });
  });
}

document.getElementById('entryForm').addEventListener('submit', e=>{
  e.preventDefault();
  const fd=new FormData(e.target);
  const entry={exercise:fd.get('exercise'), weight:parseFloat(fd.get('weight')), reps:parseInt(fd.get('reps')), date:fd.get('date')||formatDate(new Date())};
  entries.push(entry);
  saveEntries();
  renderEntries();
  e.target.reset();
  e.target.date.value=formatDate(new Date());
});

document.getElementById('exportBtn').addEventListener('click', ()=>{
  let csv='Zona Muscular,Fecha,Ejercicio,Peso,Reps,Recomendación\n';
  entries.forEach(e=>{
    const zone=getMuscleGroup(e.exercise);
    csv+=`${zone},${formatDate(e.date)},${e.exercise},${e.weight},${e.reps},"${recommendNext(e.weight,e.reps)}"\n`;
  });
  const blob=new Blob([csv],{type:'text/csv;charset=utf-8'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download='registro_pesos.csv';
  a.click();
  URL.revokeObjectURL(a.href);
});

renderEntries();
</script>
</body>
</html>
