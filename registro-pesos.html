<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Registro de Pesos — Profesional</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  html, body {height:100%; margin:0; padding:0; background:#121212; color:#e0e0e0; font-family:sans-serif;}
  #app {max-width:400px; margin:0 auto; padding:1rem;}
  .card {background:#1e1e1e; padding:1.5rem; border-radius:1rem; box-shadow:0 4px 12px rgba(0,0,0,0.7);}
  input,button,select {background:#2a2a2a; color:#e0e0e0; border:1px solid #444; border-radius:0.375rem; padding:0.5rem;}
  input:focus {outline:none; border-color:#ff6f61;}
  button:hover {opacity:0.9; cursor:pointer;}
  table {width:100%; border-collapse:collapse; margin-top:1rem;}
  th, td {padding:0.5rem; border-bottom:1px solid #333; text-align:center;}
  th {background:#2a2a2a;}
  td {background:#1e1e1e;}
  .muscle-section {margin-top:2rem;}
  .muscle-section h2 {margin-bottom:0.5rem; font-weight:bold; font-size:1.2rem; text-align:center;}
  @media (max-width: 640px) {
    table, thead, tbody, th, td, tr {display:block;}
    th {text-align:left;}
    td {text-align:left; padding-left:50%; position:relative;}
    td::before {position:absolute; left:0; width:45%; padding-left:0.5rem; font-weight:bold; content: attr(data-label);}
  }
</style>
</head>
<body>
<div id="app">
  <h1 class="text-2xl font-bold text-center mb-4">Registro de Pesos</h1>
  <div class="card">
    <form id="entryForm" class="grid grid-cols-1 gap-3 mb-4">
      <div><label>Ejercicio</label><input type="text" name="exercise" placeholder="Sentadilla" required></div>
      <div><label>Peso (kg)</label><input type="number" name="weight" step="0.5" required></div>
      <div><label>Reps</label><input type="number" name="reps" value="5" required></div>
      <div><label>Fecha</label><input type="date" name="date" value=""></div>
      <div class="text-center mt-2">
        <button type="submit" class="px-4 py-2 bg-red-600 mr-2 rounded-md">Añadir</button>
        <button id="exportBtn" type="button" class="px-4 py-2 bg-green-600 rounded-md">Exportar CSV</button>
      </div>
    </form>
    <div id="entriesArea"></div>
  </div>
</div>

<script>
const STORAGE_KEY = 'gym_entries_dark_pro';
let entries = JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]');

const MUSCLE_MAP = {
  'Pecho':['Press banca','Aperturas','Fondos'],
  'Espalda':['Dominadas','Remo','Peso muerto'],
  'Piernas':['Sentadilla','Prensa','Zancadas','Curl femoral'],
  'Hombros':['Press militar','Elevaciones laterales','Face pull'],
  'Brazos':['Curl bíceps','Extensión tríceps','Fondos de brazos'],
  'Core':['Plancha','Crunch','Elevación piernas'],
};

function getMuscleGroup(exercise){
  for(const [zone,exs] of Object.entries(MUSCLE_MAP)){
    if(exs.some(e=>e.toLowerCase()===exercise.toLowerCase())) return zone;
  }
  return 'Otros';
}

function formatDate(d){ return new Date(d).toISOString().slice(0,10); }

function recommendNext(weight, reps){
  if(!weight) return 'Sin recomendación';
  let increment;
  if(weight<20) increment=1;
  else if(weight<50) increment=2.5;
  else if(weight<100) increment=5;
  else increment=Math.round(weight*0.03*10)/10;
  const nextWeight=Math.round((weight+increment)*10)/10;
  return `Si completas las ${reps} reps con buena técnica, sube ${increment} kg la próxima sesión (de ${weight} → ${nextWeight} kg)`;
}

function saveEntries(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(entries)); }

function renderEntries(){
  const area=document.getElementById('entriesArea');
  area.innerHTML='';
  if(!entries.length){ area.innerHTML='<p class="text-gray-400 text-center">No hay entradas aún.</p>'; return; }

  const grouped={};
  entries.forEach(e=>{
    const zone=getMuscleGroup(e.exercise);
    if(!grouped[zone]) grouped[zone]=[];
    grouped[zone].push(e);
  });

  for(const [zone,exs] of Object.entries(grouped)){
    const section=document.createElement('div');
    section.className='muscle-section';
    const h2=document.createElement('h2'); h2.textContent=zone; section.appendChild(h2);

    const table=document.createElement('table');
    const thead=document.createElement('thead');
    thead.innerHTML='<tr><th>Fecha</th><th>Ejercicio</th><th>Peso</th><th>Reps</th><th>Recomendación</th><th>Acción</th></tr>';
    table.appendChild(thead);

    const tbody=document.createElement('tbody');
    exs.slice().reverse().forEach((e,i)=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td data-label="Fecha">${formatDate(e.date)}</td>
                     <td data-label="Ejercicio">${e.exercise}</td>
                     <td data-label="Peso">${e.weight}</td>
                     <td data-label="Reps">${e.reps}</td>
                     <td data-label="Recomendación">${recommendNext(e.weight,e.reps)}</td>
                     <td data-label="Acción"><button data-index="${i}" data-zone="${zone}" class="deleteBtn text-red-500">Borrar</button></td>`;
      tbody.appendChild(tr);
    });
    table.appendChild(tbody);
    section.appendChild(table);
    area.appendChild(section);
  }

  document.querySelectorAll('.deleteBtn').forEach(btn=>{
    btn.addEventListener('click', e=>{
      const idx=parseInt(e.target.dataset.index);
      const zone=e.target.dataset.zone;
      const zoneEntries=entries.filter(x=>getMuscleGroup(x.exercise)===zone);
      const toDelete=zoneEntries[zoneEntries.length-1-idx];
      if(confirm('¿Borrar esta entrada?')){
        entries=entries.filter(x=>x!==toDelete);
        saveEntries();
        renderEntries();
      }
    });
  });
}

document.getElementById('entryForm').addEventListener('submit', e=>{
  e.preventDefault();
  const fd=new FormData(e.target);
  const entry={exercise:fd.get('exercise'), weight:parseFloat(fd.get('weight')), reps:parseInt(fd.get('reps')), date:fd.get('date')||formatDate(new Date())};
  entries.push(entry);
  saveEntries();
  renderEntries();
  e.target.reset();
  e.target.date.value=formatDate(new Date());
});

document.getElementById('exportBtn').addEventListener('click', ()=>{
  let csv='Zona Muscular,Fecha,Ejercicio,Peso,Reps,Recomendación\n';
  entries.forEach(e=>{
    const zone=getMuscleGroup(e.exercise);
    csv+=`${zone},${formatDate(e.date)},${e.exercise},${e.weight},${e.reps},"${recommendNext(e.weight,e.reps)}"\n`;
  });
  const blob=new Blob([csv],{type:'text/csv;charset=utf-8'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download='registro_pesos.csv';
  a.click();
  URL.revokeObjectURL(a.href);
});

renderEntries();
</script>
</body>
</html>
