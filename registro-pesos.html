<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Registro de Pesos — Profesional</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  html,body,#app{height:100%; margin:0; padding:0;}
  body {background:#1e1e2f; color:#e0e0e0; font-family:sans-serif;}
  .card {background:#2a2a3e; padding:1.5rem; border-radius:1rem; box-shadow:0 4px 12px rgba(0,0,0,0.5);}
  input,button,select {background:#1e1e2f; color:#e0e0e0; border:1px solid #555; border-radius:0.375rem; padding:0.5rem;}
  input:focus {outline:none; border-color:#7f5af0;}
  button:hover {opacity:0.9; cursor:pointer;}
  table {width:100%; border-collapse:collapse; margin-top:1rem;}
  th,td {padding:0.5rem; border-bottom:1px solid #555; text-align:center;}
  th {background:#3a3a55;}
  td {background:#2a2a3e;}
  .muscle-section {margin-top:2rem;}
  .muscle-section h2 {margin-bottom:0.5rem; font-weight:bold; font-size:1.2rem;}
  @media (max-width: 640px) {
    table, thead, tbody, th, td, tr {display:block;}
    th {text-align:left;}
    td {text-align:left; padding-left:50%; position:relative;}
    td::before {position:absolute; left:0; width:45%; padding-left:0.5rem; font-weight:bold; content: attr(data-label);}
  }
</style>
</head>
<body>
<div id="app" class="max-w-4xl mx-auto p-4">
<h1 class="text-3xl font-bold text-center mb-6">Registro de Pesos</h1>

<div class="card">
  <form id="entryForm" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 mb-6 items-end">
    <div><label>Ejercicio</label><input type="text" name="exercise" placeholder="Sentadilla" required></div>
    <div><label>Peso (kg)</label><input type="number" name="weight" step="0.5" required></div>
    <div><label>Reps</label><input type="number" name="reps" value="5" required></div>
    <div><label>Fecha</label><input type="date" name="date" value=""></div>
    <div class="sm:col-span-2 md:col-span-4 text-right">
      <button type="submit" class="px-4 py-2 bg-purple-600 mr-2">Añadir</button>
      <button id="exportBtn" type="button" class="px-4 py-2 bg-green-600">Exportar CSV</button>
    </div>
  </form>
  <div id="entriesArea"></div>
</div>
</div>

<script>
const STORAGE_KEY = 'gym_entries_pro';
let entries = JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]');

// Definir zonas musculares
const MUSCLE_MAP = {
  'Pecho':['Press banca','Aperturas','Fondos'],
  'Espalda':['Dominadas','Remo','Peso muerto'],
  'Piernas':['Sentadilla','Prensa','Zancadas','Curl femoral'],
  'Hombros':['Press militar','Elevaciones laterales','Face pull'],
  'Brazos':['Curl bíceps','Extensión tríceps','Fondos de brazos'],
  'Core':['Plancha','Crunch','Elevación piernas'],
};

function getMuscleGroup(exercise){
  for(const [zone,exs] of Object.entries(MUSCLE_MAP)){
    if(exs.some(e=>e.toLowerCase()===exercise.toLowerCase())) return zone;
  }
  return 'Otros';
}

function formatDate(d){ return new Date(d).toISOString().slice(0,10); }

// Recomendaciones más coherentes
function recommendNext(weight){
  if(!weight) return 'Sin recomendación';
  let target;
  if(weight<20) target = weight + 1;
  else if(weight<50) target = weight + 2.5;
  else if(weight<100) target = weight + 5;
  else target = Math.round(weight*1.03*10)/10;
  const pct = Math.round(((target-weight)/weight)*100*10)/10;
  return `Subir aprox. ${pct}% (${weight} → ${Math.round(target*10)/10} kg)`;
}

function saveEntries(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(entries)); }

function renderEntries(){
  const area = document.getElementById('entriesArea');
  area.innerHTML='';
  if(!entries.length){ area.innerHTML='<p class="text-gray-400">No hay entradas aún.</p>'; return; }

  // Agrupar por zona muscular
  const grouped = {};
  entries.forEach(e=>{
    const zone = getMuscleGroup(e.exercise);
    if(!grouped[zone]) grouped[zone]=[];
    grouped[zone].push(e);
  });

  for(const [zone, exs] of Object.entries(grouped)){
    const section = document.createElement('div');
    section.className='muscle-section';
    const h2 = document.createElement('h2'); h2.textContent=zone; section.appendChild(h2);
    const table = document.createElement('table');
    const thead = document.createElement('thead');
    thead.innerHTML='<tr><th>Fecha</th><th>Ejercicio</th><th>Peso (kg)</th><th>Reps</th><th>Recomendación</th><th>Acción</th></tr>';
    table.appendChild(thead);
    const tbody = document.createElement('tbody');
    exs.slice().reverse().forEach((e,i)=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td data-label="Fecha">${formatDate(e.date)}</td>
                     <td data-label="Ejercicio">${e.exercise}</td>
                     <td data-label="Peso">${e.weight}</td>
                     <td data-label="Reps">${e.reps}</td>
                     <td data-label="Recomendación">${recommendNext(e.weight)}</td>
                     <td data-label="Acción"><button data-index="${i}" data-zone="${zone}" class="deleteBtn text-red-500">Borrar</button></td>`;
      tbody.appendChild(tr);
    });
    table.appendChild(tbody);
    section.appendChild(table);
    area.appendChild(section);
  }

  document.querySelectorAll('.deleteBtn').forEach(btn=>{
    btn.addEventListener('click', e=>{
      const idx=parseInt(e.target.dataset.index);
      const zone=e.target.dataset.zone;
      const zoneEntries=entries.filter(x=>getMuscleGroup(x.exercise)===zone);
      const toDelete=zoneEntries[zoneEntries.length-1-idx];
      if(confirm('¿Borrar esta entrada?')){
        entries=entries.filter(x=>x!==toDelete);
        saveEntries();
        renderEntries();
      }
    });
  });
}

document.getElementById('entryForm').addEventListener('submit', e=>{
  e.preventDefault();
  const fd=new FormData(e.target);
  const entry={exercise:fd.get('exercise'), weight:parseFloat(fd.get('weight')), reps:parseInt(fd.get('reps')), date:fd.get('date')||formatDate(new Date())};
  entries.push(entry);
  saveEntries();
  renderEntries();
  e.target.reset();
  e.target.date.value=formatDate(new Date());
});

document.getElementById('exportBtn').addEventListener('click', ()=>{
  let csv='Zona Muscular,Fecha,Ejercicio,Peso,Reps,Recomendación\n';
  entries.forEach(e=>{
    const zone=getMuscleGroup(e.exercise);
    csv+=`${zone},${formatDate(e.date)},${e.exercise},${e.weight},${e.reps},"${recommendNext(e.weight)}"\n`;
  });
  const blob=new Blob([csv],{type:'text/csv;charset=utf-8'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download='registro_pesos.csv';
  a.click();
  URL.revokeObjectURL(a.href);
});

renderEntries();
</script>
</body>
</html>
